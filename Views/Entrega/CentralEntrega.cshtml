@{
    ViewData["Title"] = "Central de Entregas";
}

<div class="container mt-4">

    <h2 class="mb-4">Central de Entregas</h2>

    <!-- FILTROS -->
    <div class="card p-3 shadow-sm">

        <div class="row mb-3">

            <!-- RETIRADA -->
            <div class="col-md-4">
                <label class="form-label">Tipo de Retirada</label>
                <select id="retirada" class="form-select" onchange="trocar(this.value)">
                    <option value="vazio">Selecione</option>
                    <option value="Local">Local</option>
                    <option value="Entrega">Entrega</option>
                </select>
            </div>

            <!-- SITUAÇÃO -->
            <div class="col-md-4">
                <label class="form-label">Situação</label>
                <select id="situacao" class="form-select" disabled>
                    <option value="">Selecione</option>
    
                </select>
            </div>

            <!-- BOTÃO -->
            <div class="col-md-4 d-flex align-items-end">
                <button class="btn btn-primary w-100" onclick="buscar()" id="btnBuscar" disabled>
                    Buscar Entregas
                </button>
            </div>

        </div>

    </div>

    <!-- RESULTADOS -->
    <div class="mt-4">
        <h4>Resultados</h4>
        <div id="resultadoEntregas" class="mt-3"></div>
    </div>

</div>

<script>
    
    function trocar(tipo) 
    {

        const select = document.getElementById("situacao");
        const btn = document.getElementById("btnBuscar");

        if (tipo === "Entrega") {

            btn.disabled = false;
            select.disabled = false;

            select.innerHTML = `
                <option value="">Selecione</option>
                <option value="Em andamento">Em andamento</option>
                <option value="A caminho">A caminho</option>
                <option value="Finalizada">Finalizada</option>
            `;
        }
        else if (tipo === "Local") {

            btn.disabled = false;
            select.disabled = false;

            select.innerHTML = `
                <option value="">Selecione</option>
                <option value="Em andamento">Em andamento</option>
                <option value="Finalizada">Finalizada</option>
            `;
        }
        else if (tipo === "vazio") {

            btn.disabled = true;     // <-- CORRETO
            select.disabled = true;  // <-- CORRETO

            select.innerHTML = `
                <option value="">Selecione</option>
            `;
        }
    }

   async function buscar()
    {
        var tipoEntrega = document.getElementById("retirada").value;
        var tipoSituacao = document.getElementById("situacao").value;

        var rotaBuscar = "/sistema/Entrega/BuscarEnderecos?retirada="
                      + encodeURIComponent(tipoEntrega)
                      + "&situacao="
                      + encodeURIComponent(tipoSituacao);

        console.log(rotaBuscar);

        var response = await fetch(rotaBuscar);

        var data = await response.json();

        if(!data.sucesso)
        {
            alert("Erro" + data.mensagem);
        }
        else
        {
            alert("Funcionou");
        }
    }
</script>